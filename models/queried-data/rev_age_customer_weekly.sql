WITH cleaned_data AS (
    SELECT 
        MSISDN,
        WEEK_NUMBER,
        REVENUE_USD,
        YEAR_OF_BIRTH,
        CASE
            WHEN YEAR_OF_BIRTH >= 1900 AND YEAR_OF_BIRTH < 1920 THEN '1900-1919'
            WHEN YEAR_OF_BIRTH >= 1920 AND YEAR_OF_BIRTH < 1930 THEN '1920-1929'
            WHEN YEAR_OF_BIRTH >= 1930 AND YEAR_OF_BIRTH < 1940 THEN '1930-1939'
            WHEN YEAR_OF_BIRTH >= 1940 AND YEAR_OF_BIRTH < 1950 THEN '1940-1949'
            WHEN YEAR_OF_BIRTH >= 1950 AND YEAR_OF_BIRTH < 1960 THEN '1950-1959'
            WHEN YEAR_OF_BIRTH >= 1960 AND YEAR_OF_BIRTH < 1970 THEN '1960-1969'
            WHEN YEAR_OF_BIRTH >= 1970 AND YEAR_OF_BIRTH < 1980 THEN '1970-1979'
            WHEN YEAR_OF_BIRTH >= 1980 AND YEAR_OF_BIRTH < 1990 THEN '1980-1989'
            WHEN YEAR_OF_BIRTH >= 1990 AND YEAR_OF_BIRTH < 2000 THEN '1990-1999'
            WHEN YEAR_OF_BIRTH >= 2000 AND YEAR_OF_BIRTH < 2010 THEN '2000-2009'
            WHEN YEAR_OF_BIRTH >= 2010 AND YEAR_OF_BIRTH < 2020 THEN '2010-2019'
            WHEN YEAR_OF_BIRTH >= 2020 AND YEAR_OF_BIRTH < 2030 THEN '2020-2029'
            ELSE 'Unknown' -- Default for unknown birth years
        END AS AGE_GROUP
    FROM combined_data
)

SELECT 
    WEEK_NUMBER,
    AGE_GROUP,
    SUM(REVENUE_USD) AS total_revenue
FROM cleaned_data
GROUP BY WEEK_NUMBER, AGE_GROUP

